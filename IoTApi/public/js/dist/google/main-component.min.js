function initMap(){new Vue({el:"#body",data:{shapes:[],osm:location.href.indexOf("osm")>-1,colorConfig:{border:"#000000",fill:"#00ff00",fill_highlighted:"#ff0000"}},created:function(e){var o=this,t=new google.maps.Map(document.getElementById("map"),{center:{lat:-34.397,lng:150.644},zoom:8,scaleControl:!0}),a=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon","circle"]},markerOptions:{icon:"https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png"},circleOptions:{fillColor:o.colorConfig.fill,fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!1,zIndex:1},polygonOptions:{fillColor:o.colorConfig.fill,fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!1,zIndex:1}});o.$set("map",t),o.$set("drawingManager",a),a.addListener("overlaycomplete",function(e){o.addShape(e.type,e.overlay)}),a.setMap(t),o.geoFenceTableInitialized||($("#geoFenceTable").bootstrapTable({striped:!0,toolbar:"#geoFenceTableToolbar",search:!0,showColumns:!0,uniqueId:"geoId",sortable:!0,pagination:!0,pageSize:25,sortName:"name",sortOrder:"asc",columns:[{field:"geoName",title:"Geo Fence Name",valign:"middle",sortable:!0,formatter:function(e){return'<a href="#" class="pointer geoName">'+e+"</a>"},events:{"click .geoName":function(e,t,a,n){o.$set("zoomGeoId",a.geoId),o.$get("map").panTo(a.geoType==google.maps.drawing.OverlayType.CIRCLE?{lat:a.coords.coordinates[1],lng:a.coords.coordinates[0]}:{lat:a.coords.coordinates[0][1],lng:a.coords.coordinates[0][0]})}}},{field:"geoType",title:"Type",valign:"middle",sortable:!0},{field:"coords",title:"Geo Location",valign:"middle",sortable:!1,searchable:!1,formatter:function(e,o){return JSON.stringify(e.coordinates)+(o.geoType===google.maps.drawing.OverlayType.CIRCLE?", radius: "+o.radiusInMetre+" M":"")}},{field:"createdAt",title:"Created At",align:"center",valign:"middle",sortable:!0,searchable:!1,formatter:function(e){return moment(e).format("YYYY-MM-DD HH:mm")}},{field:"operation",valign:"middle",align:"center",sortable:!1,searchable:!1,formatter:function(e,o,t){return'<button type="button" class="btn btn-xs btn-danger delete" aria-label="Delete Geo Fence"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>'},events:{"click .delete":o.deleteGeoFence}}]}),o.$set("geoFenceTableInitialized",!0)),$("#geoFenceTable").bootstrapTable("load",[]);var n=$("#tfAddress")[0],i=new google.maps.InfoWindow({}),l=new google.maps.places.SearchBox(n);t.addListener("idle",function(){l.setBounds(t.getBounds()),o.loadGeoFenceInBound()});var r=[];l.addListener("places_changed",function(){var e=l.getPlaces();if(0!=e.length){r.forEach(function(e){e.setMap(null)}),r=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){if(e.geometry){var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};r.push(new google.maps.Marker({map:t,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}}),t.fitBounds(o)}}),o.$set("infoWindow",i)},methods:{deleteGeoFence:function(e,o,t,a){var n=this;$.httpHelper.sendDelete("/geo/"+t.geoId,function(e,o){$.dialog.info("Geo Fence is deleted");var a=_.filter(n.shapes,{geoId:t.geoId})[0];a.markerRef.setMap(null),n.removeShape(t.geoType,a.shapeRef)})},removeShape:function(e,o){var t=this;o.setMap(null),_.remove(t.shapes,{geoId:o.geoId}),$("#geoFenceTable").bootstrapTable("removeByUniqueId",o.geoId)},showGeoInfoWindow:function(e){var o=this,t=o.$get("infoWindow");t.setOptions({content:e.geoName,position:e.geoType===google.maps.drawing.OverlayType.POLYGON?{lat:e.coords.coordinates[0][1],lng:e.coords.coordinates[0][0]}:{lat:e.coords.coordinates[1],lng:e.coords.coordinates[0]}}),t.open(o.$get("map"))},addShapeListener:function(e,o){var t=this;o.geoId=e.geoId,o.setMap(t.$get("map")),o.addListener("click",function(){t.showGeoInfoWindow(e)}),t.shapes.push({geoId:e.geoId,shapeRef:o})},addShape:function(e,o){var t=this;o.setMap(null),$.dialog.input("Input Geo-Fencing Name:",function(a){if(_.trim(a)){var n=t.getShapeSpec(_.trim(a),e,o);$.httpHelper.sendPost("/geo",n,function(e,a){t.addShapeListener(e.data[0],o),$("#geoFenceTable").bootstrapTable("append",e.data[0]),$("#geoFenceTable").bootstrapTable("showRow",{uniqueId:e.data[0].geoId})})}else t.addShape(e,o)})},clearSelection:function(){var e=this;_.forEach(e.shapes,function(o){o.shapeRef.setOptions({fillColor:e.colorConfig.fill,zIndex:0})})},getShapeSpec:function(e,o,t){var a={geoName:e,geoType:o,coords:{type:o===google.maps.drawing.OverlayType.CIRCLE?"Point":"Polygon"}};return o===google.maps.drawing.OverlayType.CIRCLE?(a.radiusInMetre=_.round(t.getRadius(),2),a.coords.coordinates=[t.getCenter().lng(),t.getCenter().lat()]):(a.coords.coordinates=[],_.forEach(t.getPaths().getArray(),function(e){_.forEach(e.getArray(),function(e){a.coords.coordinates.push([e.lng(),e.lat()])})})),a},loadGeoFenceInBound:function(){var e=this;e.$get("gfXhr")&&e.$get("gfXhr").abort();var o=e.$get("map").getBounds().toJSON(),t=[[o.west,o.north],[o.west,o.south],[o.east,o.south],[o.east,o.north]],a=$.httpHelper.sendPost("/geo/search/bound",t,function(o,t){if(e.$get("infoWindow").close(),_.forEach(e.shapes,function(e){e.shapeRef.setMap(null)}),e.$set("shapes",[]),_.forEach(o.data,function(o){var t;t=o.geoType===google.maps.drawing.OverlayType.CIRCLE?new google.maps.Circle({center:new google.maps.LatLng(o.coords.coordinates[1],o.coords.coordinates[0]),radius:o.radiusInMetre,fillColor:e.colorConfig.fill,fillOpacity:.5,strokeWeight:2,clickable:!0,editable:!1,zIndex:1}):new google.maps.Polygon({paths:_.map(o.coords.coordinates,function(e){return{lng:e[0],lat:e[1]}}),fillColor:e.colorConfig.fill,fillOpacity:.5,strokeWeight:2,clickable:!0,editable:!1,zIndex:1}),e.addShapeListener(o,t)}),e.$get("zoomGeoId")){var a=_.filter(e.shapes,{geoId:e.$get("zoomGeoId")})[0].shapeRef;a.setOptions({fillColor:e.colorConfig.fill_highlighted}),e.showGeoInfoWindow(_.filter(o.data,{geoId:e.$get("zoomGeoId")})[0]),e.$delete("zoomGeoId")}$("#geoFenceTable").bootstrapTable("load",o.data)});e.$set("gfXhr",a)}}})}