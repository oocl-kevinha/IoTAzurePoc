function initMap(){new Vue({el:"#body",data:{shapes:[]},created:function(e){var o=this,a=new google.maps.Map(document.getElementById("map"),{center:{lat:-34.397,lng:150.644},zoom:8}),t=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:["polygon","circle"]},markerOptions:{icon:"https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png"},circleOptions:{fillColor:"#0fff00",fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!1,zIndex:1},polygonOptions:{fillColor:"#0fff00",fillOpacity:.5,strokeWeight:2,clickable:!1,editable:!1,zIndex:1}});o.$set("map",a),o.$set("drawingManager",t),t.addListener("overlaycomplete",function(e){o.addShape(e.type,e.overlay)}),t.setMap(a),o.geoFenceTableInitialized||($("#geoFenceTable").bootstrapTable({striped:!0,toolbar:"#geoFenceTableToolbar",search:!0,showColumns:!0,uniqueId:"geoId",sortable:!0,pagination:!0,pageSize:25,sortName:"name",sortOrder:"asc",columns:[{field:"geoName",title:"Geo Fence Name",valign:"middle",sortable:!0,formatter:function(e){return'<a href="#" class="pointer geoName">'+e+"</a>"},events:{"click .geoName":function(e,a,t,n){o.clearSelection(),_.filter(o.shapes,{geoId:t.geoId})[0].shapeRef.setOptions({fillColor:"#ff0000",zIndex:99})}}},{field:"geoType",title:"Type",valign:"middle",sortable:!0},{field:"coords",title:"Geo Location",valign:"middle",sortable:!1,searchable:!1,formatter:function(e,o){return JSON.stringify(e.coordinates)+(o.geoType===google.maps.drawing.OverlayType.CIRCLE?", radius: "+o.radiusInMetre+" M":"")}},{field:"createdAt",title:"Created At",align:"center",valign:"middle",sortable:!0,searchable:!1,formatter:function(e){return moment(e).format("YYYY-MM-DD HH:mm")}},{field:"operation",valign:"middle",align:"center",sortable:!1,searchable:!1,formatter:function(e,o,a){return'<button type="button" class="btn btn-xs btn-danger delete" aria-label="Delete Geo Fence"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>'},events:{"click .delete":o.deleteGeoFence}}]}),o.$set("geoFenceTableInitialized",!0)),$("#geoFenceTable").bootstrapTable("load",[]);var n=$("#tfAddress")[0],r=new google.maps.places.SearchBox(n);a.addListener("idle",function(){r.setBounds(a.getBounds()),o.loadGeoFenceInBound()});var i=[];r.addListener("places_changed",function(){var e=r.getPlaces();if(0!=e.length){i.forEach(function(e){e.setMap(null)}),i=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){if(e.geometry){var t={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};i.push(new google.maps.Marker({map:a,icon:t,title:e.name,position:e.geometry.location})),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)}}),a.fitBounds(o)}})},methods:{deleteGeoFence:function(e,o,a,t){var n=this;$.httpHelper.sendDelete("/geo/"+a.geoId,function(e,o){$.dialog.info("Geo Fence is deleted");var t=_.filter(n.shapes,{geoId:a.geoId})[0];t.markerRef.setMap(null),n.removeShape(a.geoType,t.shapeRef)})},removeShape:function(e,o){var a=this;o.setMap(null),_.remove(a.shapes,{geoId:o.geoId}),$("#geoFenceTable").bootstrapTable("removeByUniqueId",o.geoId)},addShapeListenerAndTableRow:function(e,o){var a=this;o.geoId=e.geoId,o.setMap(a.$get("map"));var t=a.createShapeMarker(e,o);t.setMap(a.$get("map")),a.shapes.push({geoId:e.geoId,geoName:e.geoName,geoType:e.geoType,coords:e.coords.coordinates,shapeRef:o,markerRef:t,radiusInMetre:e.radiusInMetre,createdAt:e.createdAt})},createShapeMarker:function(e,o){var a={url:"https://maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",scaledSize:new google.maps.Size(25,25)},t=e.geoType===google.maps.drawing.OverlayType.CIRCLE?e.coords.coordinates:e.coords.coordinates[0][0];return new google.maps.Marker({icon:a,title:e.geoName,position:new google.maps.LatLng(t[1],t[0])})},addShape:function(e,o){var a=this;o.setMap(null),$.dialog.input("Input Geo-Fencing Name:",function(t){if(_.trim(t)){var n=a.getShapeSpec(_.trim(t),e,o);$.httpHelper.sendPost("/geo",n,function(e,t){a.addShapeListenerAndTableRow(e.data[0],o),$("#geoFenceTable").bootstrapTable("append",e.data[0]),$("#geoFenceTable").bootstrapTable("showRow",{uniqueId:e.data[0].geoId})})}else a.addShape(e,o)})},clearSelection:function(){var e=this;_.forEach(e.shapes,function(e){e.shapeRef.setOptions({fillColor:"#0fff00",zIndex:0})})},getShapeSpec:function(e,o,a){var t={geoName:e,geoType:o,coords:{type:o===google.maps.drawing.OverlayType.CIRCLE?"Point":"Polygon"}};return o===google.maps.drawing.OverlayType.CIRCLE?(t.radiusInMetre=_.round(a.getRadius(),2),t.coords.coordinates=[a.getCenter().lng(),a.getCenter().lat()]):(t.coords.coordinates=[],_.forEach(a.getPaths().getArray(),function(e){_.forEach(e.getArray(),function(e){t.coords.coordinates.push([e.lng(),e.lat()])})})),t},loadGeoFenceInBound:function(){var e=this,o=e.$get("map").getBounds().toJSON(),a=[[o.west,o.north],[o.west,o.south],[o.east,o.south],[o.east,o.north]];$.httpHelper.sendPost("/geo/search/bound",a,function(o,a){_.forEach(e.shapes,function(e){e.shapeRef.setMap(null)}),e.$set("shapes",[]),_.forEach(o.data,function(o){var a;a=o.geoType===google.maps.drawing.OverlayType.CIRCLE?new google.maps.Circle({center:new google.maps.LatLng(o.coords.coordinates[1],o.coords.coordinates[0]),radius:o.radiusInMetre,fillColor:"#0fff00",fillOpacity:.5,strokeWeight:2,clickable:!0,editable:!1,zIndex:1}):new google.maps.Polygon({paths:_.map(o.coords.coordinates[0],function(e){return{lng:e[0],lat:e[1]}}),fillColor:"#0fff00",fillOpacity:.5,strokeWeight:2,clickable:!0,editable:!1,zIndex:1}),e.addShapeListenerAndTableRow(o,a)}),$("#geoFenceTable").bootstrapTable("load",o.data)})}}})}!function(e){function o(o,a,t,n){var r=e(e("#"+o.toLowerCase()+"Dialog").length?"#"+o.toLowerCase()+"Dialog":"#messageDialog");switch(r.find(".modal-dialog").removeClass("modal-sm modal-lg").addClass("normal"===n?"":"modal-"+n),o){case"Message":r.find(".modal-title").removeClass("bg-warning bg-danger").addClass("bg-info");break;case"Warning":r.find(".modal-title").removeClass("bg-info bg-danger").addClass("bg-warning");break;case"Error":r.find(".modal-title").removeClass("bg-warning bg-info").addClass("bg-danger")}r.find(".modal-title").text(o),t?r.find(".modal-body").html(a):r.find(".modal-body").html('<div class="text-justify">'+a+"</div>"),r.modal({backdrop:"static",keyboard:!1,show:!0})}function a(o,a,t,n,r){var i=e("#inputDialog");i.find(".modal-dialog").removeClass("modal-sm modal-lg").addClass("normal"===r?"":"modal-"+r),i.find(".modal-title").addClass("bg-info"),i.find(".modal-title").text(o),n?i.find(".modal-body").html(a+'<br /><input type="text" id="tfDialogInput" />'):i.find(".modal-body").html('<div class="text-justify">'+a+'<br /><input type="text" id="tfDialogInput" /></div>'),i.off("hide.bs.modal"),i.on("hide.bs.modal",function(o){"OK"===e(document.activeElement).html()&&t&&t(e("#tfDialogInput").val())}),i.modal({backdrop:"static",keyboard:!1,show:!0})}e.dialog=e.dialog||{},e.dialog.info=function(e,a,t){o("Message",e,a,t||"sm")},e.dialog.warning=function(e,a,t){o("Warning",e,a,t||"sm")},e.dialog.error=function(e,a,t){o("Error",e,a,t||"sm")},e.dialog.input=function(e,o,t,n){a("Input",e,o,t,n||"sm")},e.dialog.confirm=function(e,o,a,t,n){}}(jQuery),function(e){function o(e){function o(){var e=new FileReader;return e.onload=a,e.onerror=n,e.onprogress=t,e}function a(e){var o=e.target.result;r.complete(void 0,o)}function t(e){if(e.lengthComputable&&r.progress){var o=e.loaded/e.total;o<1&&r.progress(e.loaded,e.total)}}function n(e){return"NotReadableError"==e.target.error.name?r.complete(new Error("Cannot Read File")):void r.complete(new Error("Unknown Error when Reading File"))}var r=this;this.file=e,this.complete=void 0,this.progress=void 0,this.getTextData=function(e,a){r.complete=e,r.progress=a,o().readAsText(r.file)}}e.getFileReader=function(e){return new o(e)}}(jQuery),function(e){function o(o,a,t,n,r){e.ajax({async:!0,url:a,data:t?JSON.stringify(t):t,method:o,contentType:"application/json",success:function(e,o){n&&n(e,o)},error:function(o,a,t){return o.responseJSON&&500!==o.status?401===o.status?void(_.isUndefined(o.responseJSON.errors)?_.isUndefined(o.responseJSON.redirectUrl)||(location.href=o.responseJSON.redirectUrl):e.dialog.error("<div>"+o.responseJSON.errors.join("</div><br /><div>")+"</div>",!0)):r?void r(o.responseJSON,a):_.isUndefined(o.responseJSON.errors)?void 0:void e.dialog.error("<div>"+o.responseJSON.errors.join("</div><br /><div>")+"</div>",!0):(e.dialog.error("Unknown error occured when communicating with server, please contact support!"),console.log(o))}})}e.httpHelper=e.httpHelper||{},e.httpHelper.sendGet=function(e,a,t){o("GET",e,void 0,a,t)},e.httpHelper.sendPost=function(e,a,t,n){o("POST",e,a,t,n)},e.httpHelper.sendPut=function(e,a,t,n){o("PUT",e,a,t,n)},e.httpHelper.sendDelete=function(e,a,t){o("DELETE",e,void 0,a,t)}}(jQuery);